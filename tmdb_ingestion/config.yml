# TMDB Ingestion Configuration
# This file centralizes all configuration for the TMDB data ingestion pipeline.
# Values can be overridden via CLI arguments in individual job scripts.

api:
  # Base API endpoints
  base_url: "https://api.themoviedb.org/3"
  discover_url: "https://api.themoviedb.org/3/discover/movie"
  details_url: "https://api.themoviedb.org/3/movie/"
  genres_url: "https://api.themoviedb.org/3/genre/movie/list"
  countries_url: "https://api.themoviedb.org/3/configuration/countries"
  languages_url: "https://api.themoviedb.org/3/configuration/languages"
  
  # Request settings
  timeout: 30  # seconds
  max_retries: 5
  
  # Movie details endpoint parameters
  append_to_response: "credits"  # Include cast/crew in movie details response

# Discover endpoint filtering and sorting
discover:
  # Filter parameters
  include_adult: false
  vote_count_gte: 100  # Minimum vote count to filter out low-quality/obscure results
  sort_by: "primary_release_date.asc"  # Sort to avoid pagination quirks
  
  # Year range for discovery (can be overridden via CLI)
  start_year: 2000
  end_year: 2025
  
  # TMDB API limitation: discover endpoint only allows access to first 500 pages
  max_pages: 500

# Ingestion pipeline settings
ingestion:
  # Batch processing
  batch_size: 500  # Number of movies to fetch per batch in details job

# Concurrency and rate limiting
concurrency:
  max_rate: 35  # Maximum requests per time_period
  time_period: 1  # Time period in seconds for rate limiting
  semaphore_limit: 10  # Maximum concurrent requests

# Storage settings
storage:
  compression: "snappy"  # Parquet compression algorithm (snappy, gzip, brotli, zstd)
  engine: "pyarrow"  # Parquet engine

# Filesystem abstraction settings
filesystem:
  # One of: local | gcs
  backend: "gcs"

  # Local settings (used when backend: local)
  local:
    # Root directory for data outputs (movies/, movie_details/, etc.)
    data_dir: "data"
    # Root directory for seed outputs (genres.csv, countries.csv, languages.csv)
    seeds_dir: "dbt/seeds"

  # GCS settings (used when backend: gcs)
  gcs:
    # Bucket to read/write ingestion artifacts.
    bucket: "tmdb-raw-a01ee0853f0cdfea"
    # Optional path prefix inside the bucket (no leading slash).
    # Example: "tmdb/ingestion" -> gs://your-bucket-name/tmdb/ingestion/
    prefix: "tmdb_ingestion"
    # Optional: explicitly set a project for clients that need it.
    project: null
    # Authentication strategy.
    # - "adc": Application Default Credentials (recommended)
    # - "service_account": load from a key file
    auth:
      method: "adc"
      service_account_json: null